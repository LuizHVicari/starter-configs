# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Development Commands

- **Development**: `pnpm dev` - Start dev server with Turbopack
- **Build**: `pnpm build` - Build production app with Turbopack
- **Lint**: `pnpm lint` - Run ESLint checks
- **Lint Fix**: `pnpm lint:fix` - Auto-fix ESLint issues
- **Start**: `pnpm start` - Start production server

### Docker Commands

- **Build**: `pnpm docker:build` - Build Docker image
- **Run Dev**: `pnpm docker:run` - Run container with .env.development
- **Run Prod**: `pnpm docker:run:prod` - Run container with .env.production
- **Custom Port**: `PORT=8080 pnpm docker:run` - Run on custom port

## Architecture Overview

This is a Next.js 15 application with App Router, featuring internationalization (i18n), theming, and a component-driven architecture.

### Key Technologies

- **Next.js 15** with App Router and Turbopack
- **TypeScript** with strict mode enabled
- **Tailwind CSS v4** for styling
- **shadcn/ui** components (New York style)
- **next-intl** for internationalization (English/Portuguese)
- **next-themes** for dark/light mode
- **React Hook Form + Zod** for form validation
- **Husky + lint-staged** for Git hooks

### Project Structure

```
src/
├── app/                    # Next.js App Router pages
├── components/
│   ├── atoms/             # Basic building blocks (typography, layout)
│   ├── molecules/         # Composite components (forms, controls)
│   └── ui/                # shadcn/ui components (ignored by ESLint)
├── features/              # Feature-based organization
│   └── common/
│       ├── client/        # Client-side code (hooks, providers)
│       ├── server/        # Server actions
│       └── shared/        # Shared utilities and components
└── i18n/                  # Internationalization configuration
```

### Component Architecture

**Atomic Design Pattern**:

- **Atoms**: Basic components in `src/components/atoms/`
- **Molecules**: Composite components in `src/components/molecules/`
- **UI Components**: shadcn/ui primitives in `src/components/ui/` (auto-generated, ignored by linter)

**Form Components**: All form components in `src/components/molecules/forms/` support dual-mode internationalization:

- Direct text props (`label`, `description`)
- Translation key props (`labelKey`, `descriptionKey`)
- Auto-translated error messages via `t(fieldState.error.message)`

### Internationalization

- **Supported locales**: English (`en`), Portuguese (`pt`)
- **Configuration**: `src/i18n/request.ts`
- **Message files**: `messages/en.json`, `messages/pt.json`
- **Locale detection**: Cookie-based with Accept-Language header fallback
- **Usage**: `useTranslations()` hook from next-intl

### Code Standards

**ESLint Configuration**: Comprehensive rules including:

- TypeScript strict checking with explicit return types required
- React/JSX best practices with prop sorting
- Import organization via `simple-import-sort`
- Code quality rules (complexity limits, cognitive complexity)
- Filename convention: kebab-case
- Prettier integration with specific formatting rules

**Git Workflow**:

- Conventional commits enforced via commitlint
- Pre-commit hooks run lint and format checks
- Supported commit types: feat, fix, docs, style, refactor, test, chore, build, ci, perf, revert

**Path Aliases**:

- `@/*` → `src/*`
- `@/components` → `src/components`
- `@/utils` → `src/features/common/shared/lib/utilities`
- `@/ui` → `src/components/ui`
- `@/lib` → `src/features/common/shared/lib`
- `@/hooks` → `src/features/common/client/hooks`

### Environment Variables

Environment variables are handled via server actions for runtime injection in Docker:

- **Development**: Use `.env.development` with `API_URL=https://dummyjson.com`
- **Docker**: Environment variables injected at runtime (no NEXT*PUBLIC* prefix needed)
- **Server Actions**: `src/features/common/server/actions/get-environment-variables.ts`
- **Config**: `src/features/common/shared/lib/config.ts` handles client/server environment access

### Docker Configuration

- **Multi-stage build**: Builder stage with Node 22 + Runner stage
- **Standalone output**: Enabled only during Docker builds via `DOCKER_BUILD=true`
- **Runtime environment**: Variables injected via server actions, not client scripts
- **Container registry**: GitHub Actions build containers for `main` (`:latest`) and `dev` (`:latest-dev`)

### GitHub Actions

- **Lint and Build**: Runs on PR/push to main/dev + manual trigger
- **Container Build**: Pushes to GitHub Container Registry after successful lint/build
- **Artifact Build**: Manual workflow for downloadable container artifacts
- **Versioning**: Uses package.json version for container tags

## Important Notes

- UI components in `src/components/ui/` are auto-generated by shadcn/ui and excluded from ESLint
- All TypeScript functions must have explicit return types
- Use `cn()` utility from `@/utils` for className merging
- Form components follow a consistent pattern with i18n support
- Theme switching is handled via next-themes with system preference detection
- Environment variables use server actions for runtime Docker injection
- **NEVER add comments in code** unless they are docstrings and explicitly requested
